{% extends "layout.html" %}

{% block title %}
    Search
{% endblock %}
{% block class %}search{% endblock %}
{% block main %}
<style>
.ui-autocomplete { max-height: 200px; overflow-y: scroll; overflow-x: hidden;}
</style>

<div class="jumbotron">
    <h1 class="display-4">Search recipes.</h1>
    <p class="lead">Tell us what's in your fridge to get the best recommendations.</p>
    <form class="form" action="/results" method="POST">
    <div class="form-group">

        <textarea id="Itemlist" name="itemlist" rows="5" readonly class="form-control" placeholder="Get started by adding some items below...">{{ingredients}}</textarea><br>
        </div>
        <div class="form-inline form-group">
            <input type="text" class="form-control bs-autocomplete-menu" id="ingredient_input" placeholder="Start typing to get suggestions..." style="width:87%" autocomplete="off">
            <a href="#" class="btn btn-primary" id="add" style="margin-left:2%"><i class="fas fa-plus"></i> Add item</a><br>
        </div>

        <div class="form-group">

            <a href="#" class="btn btn-primary" id="removelast">Remove last item</a>

            <a href="#" class="btn btn-primary" id="clear">Clear items</a>

            </div>
            <br>
            <div class="form-group">
            <button class="btn btn-primary" type="submit" id="search">Search</button>
            </div>
            </form>

    <script src="/static/ingredients.js" type="text/javascript"></script>
    <script>
        $("#ingredient_input").keydown(function(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                $("#add").click();
                document.getElementById("#ingredient_input").value = "";
                }

        });
        $('#ingredient_input').autocomplete({
        source: ingredients
    });
    </script>

    <script>

        var item_count = 0;

        // Create a new list item when clicking on the "Add" button
        $('#add').on('click', function (e) {
          var inputValue = document.getElementById("ingredient_input").value;
          if (inputValue === '') {
            alert("You must write something!");
          }
          else {
            var $edit = $("#Itemlist");
            var curValue = $edit.val();
            if (item_count == 0){
                var newValue = inputValue ;
            }
            else{
                var newValue = curValue + "\n"+ inputValue ;
            }
            item_count += 1;
            $edit.val(newValue);
          }
          document.getElementById("ingredient_input").value = "";
        });

        $('#clear').on('click', function (e) {
            item_count = 0;
            var $edit = $("#Itemlist");
            $edit.val("");
        });

        $('#removelast').on('click', function (e) {
            var $edit = $("#Itemlist");
            var curValue = $edit.val();
            var lines = curValue.split('\n');
            lines.splice((item_count - 1),1);
            if (item_count == 0){
                item_count = 0;
            }
            else{
                item_count -= 1;
            }
            $edit.val(lines.join('\n'));
        });


    </script>

{% endblock %}